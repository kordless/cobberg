IDENTIFICATION DIVISION.
PROGRAM-ID. V3-METADATA.

ENVIRONMENT DIVISION.
INPUT-OUTPUT SECTION.
FILE-CONTROL.

DATA DIVISION.
WORKING-STORAGE SECTION.
01 MANIFEST-LIST-SCHEMA.
   COPY SCHEMA-MANIFEST-LIST.

01 MANIFEST-FILE-WRAPPER.
   05 COMMIT-SNAPSHOT-ID PIC 9(18) COMP-3.
   05 SEQUENCE-NUMBER PIC 9(18) COMP-3.
   05 WRAPPED-MANIFEST-FILE PIC X(1000).

01 MANIFEST-ENTRY-WRAPPER.
   05 COMMIT-SNAPSHOT-ID PIC 9(18) COMP-3.
   05 DATA-FILE-WRAPPER.
      COPY SCHEMA-DATA-FILE.

01 DATA-FILE-WRAPPER.
   COPY SCHEMA-DATA-FILE.

PROCEDURE DIVISION.

IDENTIFICATION DIVISION.
PROGRAM-ID. MANIFEST-FILE-WRAPPER.

PROCEDURE DIVISION USING COMMIT-SNAPSHOT-ID, SEQUENCE-NUMBER, WRAPPED-MANIFEST-FILE.
    PERFORM WRAP-MANIFEST-FILE.
    EXIT PROGRAM.

WRAP-MANIFEST-FILE.
    MOVE WRAPPED-MANIFEST-FILE TO MANIFEST-FILE.
    RETURN MANIFEST-FILE.

IDENTIFICATION DIVISION.
PROGRAM-ID. MANIFEST-ENTRY-WRAPPER.

PROCEDURE DIVISION USING COMMIT-SNAPSHOT-ID.
    PERFORM WRAP-MANIFEST-ENTRY.
    EXIT PROGRAM.

WRAP-MANIFEST-ENTRY.
    MOVE COMMIT-SNAPSHOT-ID TO COMMIT-SNAPSHOT-ID.
    PERFORM WRAP-DATA-FILE.
    RETURN MANIFEST-ENTRY.

WRAP-DATA-FILE.
    MOVE DATA-FILE TO DATA-FILE-WRAPPER.
    RETURN DATA-FILE-WRAPPER.

IDENTIFICATION DIVISION.
PROGRAM-ID. ENTRY-SCHEMA.

PROCEDURE DIVISION USING PARTITION-TYPE.
    PERFORM WRAP-FILE-SCHEMA.
    RETURN ENTRY-SCHEMA.

WRAP-FILE-SCHEMA.
    MOVE FILE-SCHEMA TO ENTRY-SCHEMA.
    RETURN ENTRY-SCHEMA.

IDENTIFICATION DIVISION.
PROGRAM-ID. FILE-TYPE.

PROCEDURE DIVISION USING PARTITION-TYPE.
    PERFORM BUILD-FILE-TYPE.
    RETURN FILE-TYPE.

BUILD-FILE-TYPE.
    MOVE TYPES-STRUCT-TYPE TO FILE-TYPE.
    RETURN FILE-TYPE.

STOP RUN.
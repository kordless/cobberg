IDENTIFICATION DIVISION.
PROGRAM-ID. HadoopTables.

ENVIRONMENT DIVISION.
INPUT-OUTPUT SECTION.
FILE-CONTROL.
    SELECT DATATABLE
        ASSIGN TO ORGANIZATION SEQUENTIAL
        ACCESS MODE SEQUENTIAL
        FILE STATUS IS DATATABLE-STATUS.

DATA DIVISION.
FILE SECTION.
FD  DATATABLE.
01  DATATABLE-RECORD.
    05  DATATABLE-LOCATION    PIC X(256).
    05  DATATABLE-SCHEMA      PIC X(1024).
    05  DATATABLE-PARTSPEC    PIC X(256).
    05  DATATABLE-SORTORDER   PIC X(256).
    05  DATATABLE-PROPERTIES  PIC X(1024).

WORKING-STORAGE SECTION.
01  WS-LOCK-MANAGER          PIC X(32) VALUE SPACE.
01  WS-TABLE-BUILDER.
    05  WS-LOCATION          PIC X(256).
    05  WS-SCHEMA            PIC X(1024).
    05  WS-PARTSPEC          PIC X(256).
    05  WS-SORTORDER         PIC X(256).
    05  WS-PROPERTIES        PIC X(1024).
01  WS-METADATA-TYPE        PIC X(32).
01  WS-METADATA-LOCATION    PIC X(256).
01  WS-CONF                 PIC X(1024).
01  WS-DATATABLE-STATUS     PIC XX.

PROCEDURE DIVISION.
MAIN-PROCEDURE.
    PERFORM LOAD-TABLE
    PERFORM CREATE-TABLE
    PERFORM DROP-TABLE
    STOP RUN.

LOAD-TABLE.
    OPEN INPUT DATATABLE
    READ DATATABLE
        MOVE DATATABLE-LOCATION TO WS-METADATA-LOCATION
        MOVE DATATABLE-SCHEMA TO WS-SCHEMA
        MOVE DATATABLE-PARTSPEC TO WS-PARTSPEC
        MOVE DATATABLE-SORTORDER TO WS-SORTORDER
        MOVE DATATABLE-PROPERTIES TO WS-PROPERTIES
    CLOSE DATATABLE.

CREATE-TABLE.
    MOVE WS-LOCATION TO WS-TABLE-BUILDER-LOCATION
    MOVE WS-SCHEMA TO WS-TABLE-BUILDER-SCHEMA
    MOVE WS-PARTSPEC TO WS-TABLE-BUILDER-PARTSPEC
    MOVE WS-SORTORDER TO WS-TABLE-BUILDER-SORTORDER
    MOVE WS-PROPERTIES TO WS-TABLE-BUILDER-PROPERTIES
    PERFORM CREATE-TABLE-TRANSACTION.

CREATE-TABLE-TRANSACTION.
    OPEN OUTPUT DATATABLE
    WRITE DATATABLE-RECORD FROM WS-TABLE-BUILDER
    CLOSE DATATABLE.

DROP-TABLE.
    OPEN INPUT DATATABLE
    READ DATATABLE
        MOVE DATATABLE-LOCATION TO WS-METADATA-LOCATION
        MOVE DATATABLE-SCHEMA TO WS-SCHEMA
        MOVE DATATABLE-PARTSPEC TO WS-PARTSPEC
        MOVE DATATABLE-SORTORDER TO WS-SORTORDER
        MOVE DATATABLE-PROPERTIES TO WS-PROPERTIES
    CLOSE DATATABLE.
    PERFORM DELETE-TABLE.

DELETE-TABLE.
    OPEN OUTPUT DATATABLE
    DELETE DATATABLE RECORD
    CLOSE DATATABLE.
IDENTIFICATION DIVISION.
PROGRAM-ID. HADOOP-CATALOG.

ENVIRONMENT DIVISION.
REPOSITORY.
    CLASS HIVE-CATALOG IS "org.apache.iceberg.HadoopCatalog".

DATA DIVISION.
WORKING-STORAGE SECTION.
01 WS-CATALOG-NAME PIC X(50).
01 WS-WAREHOUSE-LOCATION PIC X(100).
01 WS-CATALOG-PROPERTIES PIC X(1000).
01 WS-SUPPRESS-PERMISSION-ERROR PIC X.
01 WS-LOCK-MANAGER PIC X(50).
01 WS-FILE-IO PIC X(50).
01 WS-CLOSEABLE-GROUP PIC X(50).
01 WS-FS PIC X(50).
01 WS-TABLE-IDENTIFIER PIC X(100).
01 WS-TABLE-OPERATIONS PIC X(50).
01 WS-NAMESPACE PIC X(100).
01 WS-NAMESPACE-LIST PIC X(1000).
01 WS-TABLE-LIST PIC X(1000).
01 WS-TABLE-METADATA PIC X(1000).
01 WS-NAMESPACE-PATH PIC X(100).
01 WS-TABLE-PATH PIC X(100).

PROCEDURE DIVISION.

MAIN-PROCEDURE.
    PERFORM INITIALIZE-CATALOG.
    PERFORM CLOSE-CATALOG.
    STOP RUN.

INITIALIZE-CATALOG.
    MOVE "hadoop" TO WS-CATALOG-NAME.
    MOVE "/warehouse/path" TO WS-WAREHOUSE-LOCATION.
    MOVE "org.apache.iceberg.hadoop.HadoopFileIO" TO WS-FILE-IO.
    MOVE "org.apache.iceberg.util.LockManagers" TO WS-LOCK-MANAGER.
    MOVE "org.apache.iceberg.io.CloseableGroup" TO WS-CLOSEABLE-GROUP.
    MOVE "org.apache.hadoop.fs.FileSystem" TO WS-FS.
    MOVE "org.apache.iceberg.hadoop.HadoopTableOperations" TO WS-TABLE-OPERATIONS.
    MOVE "org.apache.iceberg.catalog.Namespace" TO WS-NAMESPACE.
    MOVE "org.apache.iceberg.catalog.TableIdentifier" TO WS-TABLE-IDENTIFIER.

    PERFORM INITIALIZE-PROPERTIES.
    PERFORM CREATE-FILESYSTEM.
    PERFORM CREATE-FILE-IO.
    PERFORM CREATE-LOCK-MANAGER.
    PERFORM CREATE-CLOSEABLE-GROUP.

INITIALIZE-PROPERTIES.
    MOVE "warehouse-location" TO WS-CATALOG-PROPERTIES(1:20).
    MOVE WS-WAREHOUSE-LOCATION TO WS-CATALOG-PROPERTIES(21:).
    MOVE "true" TO WS-SUPPRESS-PERMISSION-ERROR.

CREATE-FILESYSTEM.
    CALL "org.apache.hadoop.fs.FileSystem" USING WS-FS, WS-WAREHOUSE-LOCATION.

CREATE-FILE-IO.
    CALL "org.apache.iceberg.CatalogUtil" USING WS-FILE-IO, WS-CATALOG-PROPERTIES, WS-FS.

CREATE-LOCK-MANAGER.
    CALL "org.apache.iceberg.util.LockManagers" USING WS-LOCK-MANAGER, WS-CATALOG-PROPERTIES.

CREATE-CLOSEABLE-GROUP.
    CALL "org.apache.iceberg.io.CloseableGroup" USING WS-CLOSEABLE-GROUP.
    CALL "addCloseable" USING WS-CLOSEABLE-GROUP, WS-LOCK-MANAGER.
    CALL "addCloseable" USING WS-CLOSEABLE-GROUP, "org.apache.iceberg.hadoop.HadoopCatalog::metricsReporter".
    CALL "setSuppressCloseFailure" USING WS-CLOSEABLE-GROUP, "true".

CLOSE-CATALOG.
    CALL "close" USING WS-CLOSEABLE-GROUP.
IDENTIFICATION DIVISION.
PROGRAM-ID. IN-MEMORY-CATALOG.

ENVIRONMENT DIVISION.
INPUT-OUTPUT SECTION.
FILE-CONTROL.
    SELECT OPTIONAL CLOSEABLE-GROUP
        ASSIGN TO SYSIN
        ORGANIZATION IS SEQUENTIAL.

DATA DIVISION.
FILE SECTION.
FD CLOSEABLE-GROUP.

WORKING-STORAGE SECTION.
01 NAMESPACES PIC X(10) VALUE "NAMESPACES".
01 TABLES PIC X(6) VALUE "TABLES".
01 VIEWS PIC X(5) VALUE "VIEWS".
01 CATALOG-NAME PIC X(20) VALUE "CATALOG-NAME".
01 WAREHOUSE-LOCATION PIC X(30) VALUE "WAREHOUSE-LOCATION".
01 CATALOG-PROPERTIES PIC X(20) VALUE "CATALOG-PROPERTIES".

PROCEDURE DIVISION.
MAIN-PROCEDURE.
    PERFORM INITIALIZE-CATALOG.
    PERFORM HANDLE-TABLE-OPERATIONS.
    PERFORM HANDLE-NAMESPACE-OPERATIONS.
    PERFORM HANDLE-VIEW-OPERATIONS.
    PERFORM CLOSE-CATALOG.
    STOP RUN.

INITIALIZE-CATALOG.
    MOVE SPACES TO NAMESPACES, TABLES, VIEWS.
    MOVE SPACES TO CATALOG-NAME, WAREHOUSE-LOCATION, CATALOG-PROPERTIES.

HANDLE-TABLE-OPERATIONS.
    PERFORM DROP-TABLE.
    PERFORM LIST-TABLES.
    PERFORM RENAME-TABLE.

DROP-TABLE.
    PERFORM COMPUTE-TABLE-OPERATIONS.
    PERFORM PURGE-TABLE-DATA.

COMPUTE-TABLE-OPERATIONS.
    PERFORM COMPUTE-TABLE-IDENTIFIER.
    PERFORM COMPUTE-TABLE-LOCATION.
    PERFORM COMPUTE-TABLE-METADATA.

COMPUTE-TABLE-IDENTIFIER.
    PERFORM COMPUTE-NAMESPACE.
    PERFORM COMPUTE-TABLE-NAME.

COMPUTE-NAMESPACE.
    IF NAMESPACE-EXISTS
        CONTINUE
    ELSE
        PERFORM RAISE-NAMESPACE-EXCEPTION.

COMPUTE-TABLE-NAME.
    PERFORM LOOKUP-TABLE.
    IF TABLE-FOUND
        CONTINUE
    ELSE
        PERFORM RAISE-TABLE-EXCEPTION.

PURGE-TABLE-DATA.
    PERFORM COMPUTE-TABLE-METADATA.
    PERFORM DROP-TABLE-DATA.

DROP-TABLE-DATA.
    CALL "CATALOG-UTIL" USING TABLE-METADATA, IO.

LIST-TABLES.
    PERFORM COMPUTE-NAMESPACE.
    PERFORM LOOKUP-TABLES.
    PERFORM SORT-TABLE-IDENTIFIERS.

RENAME-TABLE.
    PERFORM COMPUTE-FROM-TABLE-IDENTIFIER.
    PERFORM COMPUTE-TO-TABLE-IDENTIFIER.
    PERFORM CHECK-RENAME-PRECONDITIONS.
    PERFORM UPDATE-TABLE-LOCATION.

HANDLE-NAMESPACE-OPERATIONS.
    PERFORM CREATE-NAMESPACE.
    PERFORM CHECK-NAMESPACE-EXISTS.
    PERFORM DROP-NAMESPACE.
    PERFORM SET-NAMESPACE-PROPERTIES.
    PERFORM REMOVE-NAMESPACE-PROPERTIES.
    PERFORM LOAD-NAMESPACE-METADATA.
    PERFORM LIST-NAMESPACES.

CREATE-NAMESPACE.
    PERFORM COMPUTE-NAMESPACE.
    IF NAMESPACE-EXISTS
        PERFORM RAISE-NAMESPACE-EXCEPTION
    ELSE
        PERFORM ADD-NAMESPACE.

ADD-NAMESPACE.
    MOVE NAMESPACE TO NAMESPACES.
    MOVE NAMESPACE-METADATA TO NAMESPACES(NAMESPACE).

CHECK-NAMESPACE-EXISTS.
    PERFORM COMPUTE-NAMESPACE.
    IF NAMESPACE-EXISTS
        CONTINUE
    ELSE
        PERFORM RAISE-NAMESPACE-EXCEPTION.

DROP-NAMESPACE.
    PERFORM COMPUTE-NAMESPACE.
    PERFORM CHECK-NAMESPACE-EXISTS.
    PERFORM CHECK-NAMESPACE-NOT-EMPTY.
    PERFORM REMOVE-NAMESPACE.

CHECK-NAMESPACE-NOT-EMPTY.
    PERFORM LIST-TABLES-IN-NAMESPACE.
    IF TABLES-FOUND
        PERFORM RAISE-NAMESPACE-NOT-EMPTY-EXCEPTION.

REMOVE-NAMESPACE.
    MOVE SPACES TO NAMESPACES(NAMESPACE).

SET-NAMESPACE-PROPERTIES.
    PERFORM COMPUTE-NAMESPACE.
    PERFORM CHECK-NAMESPACE-EXISTS.
    PERFORM UPDATE-NAMESPACE-PROPERTIES.

UPDATE-NAMESPACE-PROPERTIES.
    MOVE NAMESPACE-PROPERTIES TO NAMESPACES(NAMESPACE).

REMOVE-NAMESPACE-PROPERTIES.
    PERFORM COMPUTE-NAMESPACE.
    PERFORM CHECK-NAMESPACE-EXISTS.
    PERFORM DELETE-NAMESPACE-PROPERTIES.

DELETE-NAMESPACE-PROPERTIES.
    MOVE SPACES TO NAMESPACES(NAMESPACE, PROPERTY).

LOAD-NAMESPACE-METADATA.
    PERFORM COMPUTE-NAMESPACE.
    PERFORM CHECK-NAMESPACE-EXISTS.
    MOVE NAMESPACES(NAMESPACE) TO NAMESPACE-METADATA.

LIST-NAMESPACES.
    PERFORM COLLECT-NAMESPACES.
    PERFORM SORT-NAMESPACES.

COLLECT-NAMESPACES.
    MOVE SPACES TO NAMESPACE-LIST.
    PERFORM VARYING NAMESPACE FROM 1 BY 1 UNTIL NAMESPACE > MAX-NAMESPACES
        IF NAMESPACES(NAMESPACE) NOT EQUAL SPACES
            MOVE NAMESPACE TO NAMESPACE-LIST(NAMESPACE)
        END-IF
    END-PERFORM.

SORT-NAMESPACES.
    PERFORM SORT NAMESPACE-LIST ASCENDING.

HANDLE-VIEW-OPERATIONS.
    PERFORM LIST-VIEWS.
    PERFORM DROP-VIEW.
    PERFORM RENAME-VIEW.

LIST-VIEWS.
    PERFORM COMPUTE-NAMESPACE.
    PERFORM LOOKUP-VIEWS.
    PERFORM SORT-VIEW-IDENTIFIERS.

DROP-VIEW.
    PERFORM COMPUTE-VIEW-IDENTIFIER.
    PERFORM REMOVE-VIEW.

REMOVE-VIEW.
    MOVE SPACES TO VIEWS(VIEW-IDENTIFIER).

RENAME-VIEW.
    PERFORM COMPUTE-FROM-VIEW-IDENTIFIER.
    PERFORM COMPUTE-TO-VIEW-IDENTIFIER.
    PERFORM CHECK-RENAME-VIEW-PRECONDITIONS.
    PERFORM UPDATE-VIEW-LOCATION.

CLOSE-CATALOG.
    PERFORM CLOSE CLOSEABLE-GROUP.
    MOVE SPACES TO NAMESPACES, TABLES, VIEWS.
    MOVE SPACES TO CATALOG-NAME, WAREHOUSE-LOCATION, CATALOG-PROPERTIES.

STOP RUN.
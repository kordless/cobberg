IDENTIFICATION DIVISION.
PROGRAM-ID. PARTITIONS-TABLE.

ENVIRONMENT DIVISION.
REPOSITORY.
    COPY "ICEBERG-TYPES.cpy".

DATA DIVISION.
WORKING-STORAGE SECTION.
01 SCHEMA.
    05 PARTITION-FIELD COPY "ICEBERG-FIELD.cpy".
    05 SPEC-ID-FIELD COPY "ICEBERG-FIELD.cpy".
    05 RECORD-COUNT-FIELD COPY "ICEBERG-FIELD.cpy".
    05 FILE-COUNT-FIELD COPY "ICEBERG-FIELD.cpy".
    05 TOTAL-DATA-FILE-SIZE-IN-BYTES-FIELD COPY "ICEBERG-FIELD.cpy".
    05 POSITION-DELETE-RECORD-COUNT-FIELD COPY "ICEBERG-FIELD.cpy".
    05 POSITION-DELETE-FILE-COUNT-FIELD COPY "ICEBERG-FIELD.cpy".
    05 EQUALITY-DELETE-RECORD-COUNT-FIELD COPY "ICEBERG-FIELD.cpy".
    05 EQUALITY-DELETE-FILE-COUNT-FIELD COPY "ICEBERG-FIELD.cpy".
    05 LAST-UPDATED-AT-FIELD COPY "ICEBERG-FIELD.cpy".
    05 LAST-UPDATED-SNAPSHOT-ID-FIELD COPY "ICEBERG-FIELD.cpy".

01 UNPARTITIONED-TABLE PIC X(1) VALUE "N".
01 PARTITION-MAP.
    05 PARTITIONS OCCURS 1 TO 9999 TIMES DEPENDING ON PARTITION-COUNT.
        10 PARTITION-DATA COPY "ICEBERG-PARTITION-DATA.cpy".
        10 SPEC-ID PIC 9(9) COMP.
        10 DATA-RECORD-COUNT PIC 9(18) COMP.
        10 DATA-FILE-COUNT PIC 9(9) COMP.
        10 DATA-FILE-SIZE-IN-BYTES PIC 9(18) COMP.
        10 POSITION-DELETE-RECORD-COUNT PIC 9(18) COMP.
        10 POSITION-DELETE-FILE-COUNT PIC 9(9) COMP.
        10 EQUALITY-DELETE-RECORD-COUNT PIC 9(18) COMP.
        10 EQUALITY-DELETE-FILE-COUNT PIC 9(9) COMP.
        10 LAST-UPDATED-AT PIC 9(18) COMP.
        10 LAST-UPDATED-SNAPSHOT-ID PIC 9(18) COMP.
01 PARTITION-COUNT PIC 9(9) COMP VALUE 0.

PROCEDURE DIVISION.
MAIN-PROCEDURE.
    PERFORM VARYING I FROM 1 BY 1 UNTIL I > PARTITION-COUNT
        PERFORM UPDATE-PARTITION
    END-PERFORM.

UPDATE-PARTITION.
    MOVE PARTITION-DATA(I) TO PARTITION-DATA
    MOVE SPEC-ID(I) TO SPEC-ID
    MOVE DATA-RECORD-COUNT(I) TO DATA-RECORD-COUNT
    MOVE DATA-FILE-COUNT(I) TO DATA-FILE-COUNT
    MOVE DATA-FILE-SIZE-IN-BYTES(I) TO DATA-FILE-SIZE-IN-BYTES
    MOVE POSITION-DELETE-RECORD-COUNT(I) TO POSITION-DELETE-RECORD-COUNT
    MOVE POSITION-DELETE-FILE-COUNT(I) TO POSITION-DELETE-FILE-COUNT
    MOVE EQUALITY-DELETE-RECORD-COUNT(I) TO EQUALITY-DELETE-RECORD-COUNT
    MOVE EQUALITY-DELETE-FILE-COUNT(I) TO EQUALITY-DELETE-FILE-COUNT
    MOVE LAST-UPDATED-AT(I) TO LAST-UPDATED-AT
    MOVE LAST-UPDATED-SNAPSHOT-ID(I) TO LAST-UPDATED-SNAPSHOT-ID.

PARTITION-SCHEMA.
    05 PARTITION-FIELD.
        10 PARTITION-DATA COPY "ICEBERG-PARTITION-DATA.cpy".
    05 SPEC-ID-FIELD PIC 9(9) COMP.
    05 RECORD-COUNT-FIELD PIC 9(18) COMP.
    05 FILE-COUNT-FIELD PIC 9(9) COMP.
    05 TOTAL-DATA-FILE-SIZE-IN-BYTES-FIELD PIC 9(18) COMP.
    05 POSITION-DELETE-RECORD-COUNT-FIELD PIC 9(18) COMP.
    05 POSITION-DELETE-FILE-COUNT-FIELD PIC 9(9) COMP.
    05 EQUALITY-DELETE-RECORD-COUNT-FIELD PIC 9(18) COMP.
    05 EQUALITY-DELETE-FILE-COUNT-FIELD PIC 9(9) COMP.
    05 LAST-UPDATED-AT-FIELD PIC 9(18) COMP.
    05 LAST-UPDATED-SNAPSHOT-ID-FIELD PIC 9(18) COMP.

PARTITION-CONVERSION.
    MOVE PARTITION-DATA TO PARTITION-FIELD
    MOVE SPEC-ID TO SPEC-ID-FIELD
    MOVE DATA-RECORD-COUNT TO RECORD-COUNT-FIELD
    MOVE DATA-FILE-COUNT TO FILE-COUNT-FIELD
    MOVE DATA-FILE-SIZE-IN-BYTES TO TOTAL-DATA-FILE-SIZE-IN-BYTES-FIELD
    MOVE POSITION-DELETE-RECORD-COUNT TO POSITION-DELETE-RECORD-COUNT-FIELD
    MOVE POSITION-DELETE-FILE-COUNT TO POSITION-DELETE-FILE-COUNT-FIELD
    MOVE EQUALITY-DELETE-RECORD-COUNT TO EQUALITY-DELETE-RECORD-COUNT-FIELD
    MOVE EQUALITY-DELETE-FILE-COUNT TO EQUALITY-DELETE-FILE-COUNT-FIELD
    MOVE LAST-UPDATED-AT TO LAST-UPDATED-AT-FIELD
    MOVE LAST-UPDATED-SNAPSHOT-ID TO LAST-UPDATED-SNAPSHOT-ID-FIELD.
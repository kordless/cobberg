IDENTIFICATION DIVISION.
PROGRAM-ID. SNAPSHOTUTIL.

ENVIRONMENT DIVISION.
REPOSITORY.
    COPY "org/apache/iceberg/DataFile.cpy".
    COPY "org/apache/iceberg/HistoryEntry.cpy".
    COPY "org/apache/iceberg/Schema.cpy".
    COPY "org/apache/iceberg/Snapshot.cpy".
    COPY "org/apache/iceberg/SnapshotRef.cpy".
    COPY "org/apache/iceberg/Table.cpy".
    COPY "org/apache/iceberg/TableMetadata.cpy".
    COPY "org/apache/iceberg/exceptions/ValidationException.cpy".
    COPY "org/apache/iceberg/io/FileIO.cpy".
    COPY "org/apache/iceberg/relocated/com/google/common/base/Preconditions.cpy".
    COPY "org/apache/iceberg/relocated/com/google/common/collect/ImmutableList.cpy".
    COPY "org/apache/iceberg/relocated/com/google/common/collect/Iterables.cpy".
    COPY "org/apache/iceberg/relocated/com/google/common/collect/Lists.cpy".
    COPY "org/apache/iceberg/util/DateTimeUtil.cpy".

DATA DIVISION.
WORKING-STORAGE SECTION.
01 WS-SNAPSHOTUTIL.
    05 WS-SNAPSHOTID       PIC 9(18) COMP-3.
    05 WS-ANCESTORSNAPSHOTID PIC 9(18) COMP-3.
    05 WS-ANCESTORPARENTSNAPSHOTID PIC 9(18) COMP-3.
    05 WS-TIMESTAMPMILLIS   PIC 9(18) COMP-3.
    05 WS-SCHEMA-ID         PIC 9(9) COMP.
    05 WS-REF               PIC X(128).

PROCEDURE DIVISION.

IDENTIFICATION-SECTION.
    ENTRY "IS-ANCESTOROF".
        CALL "ISANCESTOROF" USING WS-SNAPSHOTID, WS-ANCESTORSNAPSHOTID, LOOKUP-FUNCTION.
        RETURN.

    ENTRY "IS-ANCESTOROF-TABLE".
        CALL "ISANCESTOROF" USING TABLE, WS-SNAPSHOTID, WS-ANCESTORSNAPSHOTID.
        RETURN.

    ENTRY "IS-PARENTANCESTOROF".
        CALL "ISPARENTANCESTOROF" USING TABLE, WS-SNAPSHOTID, WS-ANCESTORPARENTSNAPSHOTID.
        RETURN.

    ENTRY "CURRENT-ANCESTORS".
        CALL "CURRENTANCESTORS" USING TABLE.
        RETURN.

    ENTRY "CURRENT-ANCESTOR-IDS".
        CALL "CURRENTANCESTORIDS" USING TABLE.
        RETURN.

    ENTRY "OLDEST-ANCESTOR".
        CALL "OLDESTANCESTOR" USING TABLE.
        RETURN.

    ENTRY "OLDEST-ANCESTOR-OF".
        CALL "OLDESTANCESTOROF" USING TABLE, WS-SNAPSHOTID.
        RETURN.

    ENTRY "OLDEST-ANCESTOR-OF-LOOKUP".
        CALL "OLDESTANCESTOROF" USING WS-SNAPSHOTID, LOOKUP-FUNCTION.
        RETURN.

    ENTRY "ANCESTORS-OF".
        CALL "ANCESTORSOF" USING WS-SNAPSHOTID, LOOKUP-FUNCTION.
        RETURN.

    ENTRY "OLDEST-ANCESTOR-AFTER".
        CALL "OLDESTANCESTORAFTER" USING TABLE, WS-TIMESTAMPMILLIS.
        RETURN.

    ENTRY "SNAPSHOT-IDS-BETWEEN".
        CALL "SNAPSHOTIDSBETWEEN" USING TABLE, WS-SNAPSHOTID, WS-ANCESTORSNAPSHOTID.
        RETURN.

    ENTRY "ANCESTOR-IDS-BETWEEN".
        CALL "ANCESTORIDSBETWEEN" USING WS-SNAPSHOTID, WS-ANCESTORSNAPSHOTID, LOOKUP-FUNCTION.
        RETURN.

    ENTRY "ANCESTORS-BETWEEN".
        CALL "ANCESTORSBETWEEN" USING TABLE, WS-SNAPSHOTID, WS-ANCESTORSNAPSHOTID.
        RETURN.

    ENTRY "ANCESTORS-BETWEEN-LOOKUP".
        CALL "ANCESTORSBETWEEN" USING WS-SNAPSHOTID, WS-ANCESTORSNAPSHOTID, LOOKUP-FUNCTION.
        RETURN.

    ENTRY "NEW-FILES".
        CALL "NEWFILES" USING WS-ANCESTORSNAPSHOTID, WS-SNAPSHOTID, LOOKUP-FUNCTION, FILE-IO.
        RETURN.

    ENTRY "SNAPSHOT-AFTER".
        CALL "SNAPSHOTAFTER" USING TABLE, WS-SNAPSHOTID.
        RETURN.

    ENTRY "SNAPSHOT-ID-AS-OF-TIME".
        CALL "SNAPSHOTIDASOFTIME" USING TABLE, WS-TIMESTAMPMILLIS.
        RETURN.

    ENTRY "NULLABLE-SNAPSHOT-ID-AS-OF-TIME".
        CALL "NULLABLESNAPSHOTIDASOFTIME" USING TABLE, WS-TIMESTAMPMILLIS.
        RETURN.

    ENTRY "SCHEMA-FOR-SNAPSHOT".
        CALL "SCHEMAFOR" USING TABLE, WS-SNAPSHOTID.
        RETURN.

    ENTRY "SCHEMA-FOR-SNAPSHOT-OR-TIME".
        CALL "SCHEMAFOR" USING TABLE, WS-SNAPSHOTID, WS-TIMESTAMPMILLIS.
        RETURN.

    ENTRY "SCHEMA-FOR-REF".
        CALL "SCHEMAFOR" USING TABLE, WS-REF.
        RETURN.

    ENTRY "SCHEMA-FOR-REF-METADATA".
        CALL "SCHEMAFOR" USING METADATA, WS-REF.
        RETURN.

    ENTRY "LATEST-SNAPSHOT".
        CALL "LATESTSNAPSHOT" USING TABLE, WS-REF.
        RETURN.

    ENTRY "LATEST-SNAPSHOT-METADATA".
        CALL "LATESTSNAPSHOT" USING METADATA, WS-REF.
        RETURN.

COPY "org/apache/iceberg/util/SnapshotUtil.cpy".
IDENTIFICATION DIVISION.
PROGRAM-ID. METADATA-UPDATE-PARSER.

ENVIRONMENT DIVISION.
REPOSITORY.
    COPY "SCHEMA-PARSER.cpy".
    COPY "PARTITION-SPEC-PARSER.cpy".
    COPY "SORT-ORDER-PARSER.cpy".
    COPY "STATISTICS-FILE-PARSER.cpy".
    COPY "PARTITION-STATISTICS-FILE-PARSER.cpy".
    COPY "SNAPSHOT-PARSER.cpy".
    COPY "VIEW-VERSION-PARSER.cpy".

DATA DIVISION.
WORKING-STORAGE SECTION.
01 WS-ACTIONS.
    05 ASSIGN-UUID                 PIC X(11) VALUE "assign-uuid".
    05 UPGRADE-FORMAT-VERSION      PIC X(19) VALUE "upgrade-format-version".
    05 ADD-SCHEMA                  PIC X(10) VALUE "add-schema".
    05 SET-CURRENT-SCHEMA          PIC X(16) VALUE "set-current-schema".
    05 ADD-PARTITION-SPEC          PIC X(13) VALUE "add-partition-spec".
    05 SET-DEFAULT-PARTITION-SPEC  PIC X(21) VALUE "set-default-partition-spec".
    05 ADD-SORT-ORDER              PIC X(12) VALUE "add-sort-order".
    05 SET-DEFAULT-SORT-ORDER      PIC X(19) VALUE "set-default-sort-order".
    05 SET-STATISTICS              PIC X(13) VALUE "set-statistics".
    05 REMOVE-STATISTICS           PIC X(16) VALUE "remove-statistics".
    05 SET-PARTITION-STATISTICS    PIC X(20) VALUE "set-partition-statistics".
    05 REMOVE-PARTITION-STATISTICS PIC X(25) VALUE "remove-partition-statistics".
    05 ADD-SNAPSHOT                PIC X(11) VALUE "add-snapshot".
    05 REMOVE-SNAPSHOTS            PIC X(14) VALUE "remove-snapshots".
    05 REMOVE-SNAPSHOT-REF         PIC X(17) VALUE "remove-snapshot-ref".
    05 SET-SNAPSHOT-REF            PIC X(13) VALUE "set-snapshot-ref".
    05 SET-PROPERTIES              PIC X(13) VALUE "set-properties".
    05 REMOVE-PROPERTIES           PIC X(16) VALUE "remove-properties".
    05 SET-LOCATION                PIC X(12) VALUE "set-location".
    05 ADD-VIEW-VERSION            PIC X(13) VALUE "add-view-version".
    05 SET-CURRENT-VIEW-VERSION    PIC X(20) VALUE "set-current-view-version".
    05 REMOVE-PARTITION-SPECS      PIC X(19) VALUE "remove-partition-specs".
    05 ENABLE-ROW-LINEAGE          PIC X(16) VALUE "enable-row-lineage".

01 WS-UUID                        PIC X(36).
01 WS-FORMAT-VERSION              PIC 9(10).
01 WS-SCHEMA-ID                   PIC 9(10).
01 WS-SPEC-ID                     PIC 9(10).
01 WS-SORT-ORDER-ID               PIC 9(10).
01 WS-SNAPSHOT-ID                 PIC 9(18).
01 WS-VIEW-VERSION-ID             PIC 9(10).
01 WS-SPEC-IDS                    PIC 9(10) OCCURS 10 TIMES.
01 WS-SPEC-IDS-COUNT              PIC 9(2).

PROCEDURE DIVISION.

ASSIGN-UUID-PARAGRAPH.
    MOVE WS-UUID TO METADATA-UPDATE-ASSIGN-UUID-UUID.
    PERFORM METADATA-UPDATE-ASSIGN-UUID.

UPGRADE-FORMAT-VERSION-PARAGRAPH.
    MOVE WS-FORMAT-VERSION TO METADATA-UPDATE-UPGRADE-FORMAT-VERSION-FORMAT-VERSION.
    PERFORM METADATA-UPDATE-UPGRADE-FORMAT-VERSION.

ADD-SCHEMA-PARAGRAPH.
    MOVE WS-SCHEMA-ID TO METADATA-UPDATE-ADD-SCHEMA-LAST-COLUMN-ID.
    PERFORM METADATA-UPDATE-ADD-SCHEMA.

SET-CURRENT-SCHEMA-PARAGRAPH.
    MOVE WS-SCHEMA-ID TO METADATA-UPDATE-SET-CURRENT-SCHEMA-SCHEMA-ID.
    PERFORM METADATA-UPDATE-SET-CURRENT-SCHEMA.

ADD-PARTITION-SPEC-PARAGRAPH.
    PERFORM METADATA-UPDATE-ADD-PARTITION-SPEC.

SET-DEFAULT-PARTITION-SPEC-PARAGRAPH.
    MOVE WS-SPEC-ID TO METADATA-UPDATE-SET-DEFAULT-PARTITION-SPEC-SPEC-ID.
    PERFORM METADATA-UPDATE-SET-DEFAULT-PARTITION-SPEC.

ADD-SORT-ORDER-PARAGRAPH.
    PERFORM METADATA-UPDATE-ADD-SORT-ORDER.

SET-DEFAULT-SORT-ORDER-PARAGRAPH.
    MOVE WS-SORT-ORDER-ID TO METADATA-UPDATE-SET-DEFAULT-SORT-ORDER-SORT-ORDER-ID.
    PERFORM METADATA-UPDATE-SET-DEFAULT-SORT-ORDER.

SET-STATISTICS-PARAGRAPH.
    MOVE WS-SNAPSHOT-ID TO METADATA-UPDATE-SET-STATISTICS-SNAPSHOT-ID.
    PERFORM METADATA-UPDATE-SET-STATISTICS.

REMOVE-STATISTICS-PARAGRAPH. 
    MOVE WS-SNAPSHOT-ID TO METADATA-UPDATE-REMOVE-STATISTICS-SNAPSHOT-ID.
    PERFORM METADATA-UPDATE-REMOVE-STATISTICS.

SET-PARTITION-STATISTICS-PARAGRAPH.
    PERFORM METADATA-UPDATE-SET-PARTITION-STATISTICS.

REMOVE-PARTITION-STATISTICS-PARAGRAPH.
    MOVE WS-SNAPSHOT-ID TO METADATA-UPDATE-REMOVE-PARTITION-STATISTICS-SNAPSHOT-ID.
    PERFORM METADATA-UPDATE-REMOVE-PARTITION-STATISTICS.

ADD-SNAPSHOT-PARAGRAPH.
    PERFORM METADATA-UPDATE-ADD-SNAPSHOT.

REMOVE-SNAPSHOTS-PARAGRAPH.
    MOVE WS-SNAPSHOT-ID TO METADATA-UPDATE-REMOVE-SNAPSHOT-SNAPSHOT-ID.
    PERFORM METADATA-UPDATE-REMOVE-SNAPSHOT.

SET-SNAPSHOT-REF-PARAGRAPH.
    MOVE WS-SNAPSHOT-ID TO METADATA-UPDATE-SET-SNAPSHOT-REF-SNAPSHOT-ID.
    PERFORM METADATA-UPDATE-SET-SNAPSHOT-REF.

REMOVE-SNAPSHOT-REF-PARAGRAPH.
    PERFORM METADATA-UPDATE-REMOVE-SNAPSHOT-REF.

SET-PROPERTIES-PARAGRAPH.
    PERFORM METADATA-UPDATE-SET-PROPERTIES.

REMOVE-PROPERTIES-PARAGRAPH.
    PERFORM METADATA-UPDATE-REMOVE-PROPERTIES.

SET-LOCATION-PARAGRAPH.
    PERFORM METADATA-UPDATE-SET-LOCATION.

ADD-VIEW-VERSION-PARAGRAPH.
    PERFORM METADATA-UPDATE-ADD-VIEW-VERSION.

SET-CURRENT-VIEW-VERSION-PARAGRAPH.
    MOVE WS-VIEW-VERSION-ID TO METADATA-UPDATE-SET-CURRENT-VIEW-VERSION-VIEW-VERSION-ID.
    PERFORM METADATA-UPDATE-SET-CURRENT-VIEW-VERSION.

REMOVE-PARTITION-SPECS-PARAGRAPH.
    MOVE WS-SPEC-IDS-COUNT TO METADATA-UPDATE-REMOVE-PARTITION-SPECS-SPEC-IDS-COUNT.
    MOVE WS-SPEC-IDS TO METADATA-UPDATE-REMOVE-PARTITION-SPECS-SPEC-IDS.
    PERFORM METADATA-UPDATE-REMOVE-PARTITION-SPECS.

ENABLE-ROW-LINEAGE-PARAGRAPH.
    PERFORM METADATA-UPDATE-ENABLE-ROW-LINEAGE.

STOP RUN.
IDENTIFICATION DIVISION.
PROGRAM-ID. BASE-FILE.

ENVIRONMENT DIVISION.
REPOSITORY.
    FUNCTION FILE-FORMAT-FROM-STRING.

DATA DIVISION.
WORKING-STORAGE SECTION.
01 FILE-CONTENT-VALUES.
   02 FILLER PIC X(5) VALUE 'DATA'.
   02 FILLER PIC X(7) VALUE 'DELETE'.
   02 FILLER PIC X(11) VALUE 'POSITION_ONLY'.
01 EMPTY-STRUCT-TYPE.
01 EMPTY-PARTITION-DATA.
   02 PARTITION-TYPE PIC X(20) VALUE 'EMPTY-STRUCT-TYPE'.
01 BASE-TYPE.
   02 CONTENT PIC X(11).
   02 FILE-PATH PIC X(256).
   02 FILE-FORMAT PIC X(20).
   02 SPEC-ID PIC 9(9).
   02 PARTITION-DATA.
      03 PARTITION-ID PIC 9(9).
      03 PARTITION-NAME PIC X(256).
      03 PARTITION-TYPE PIC X(20).
      03 PARTITION-DOC PIC X(20).
   02 RECORD-COUNT PIC 9(18) COMP.
   02 FILE-SIZE PIC 9(18) COMP.
   02 COLUMN-SIZES PIC X(32766).
   02 VALUE-COUNTS PIC X(32766).
   02 NULL-VALUE-COUNTS PIC X(32766).
   02 NAN-VALUE-COUNTS PIC X(32766).
   02 LOWER-BOUNDS PIC X(32766).
   02 UPPER-BOUNDS PIC X(32766).
   02 KEY-METADATA PIC X(32766).
   02 SPLIT-OFFSETS PIC X(32766).
   02 EQUALITY-IDS PIC X(32766).
   02 SORT-ORDER-ID PIC 9(9).
   02 REFERENCED-DATA-FILE PIC X(256).
   02 CONTENT-OFFSET PIC 9(18) COMP.
   02 CONTENT-SIZE PIC 9(18) COMP.
   02 ROW-POSITION PIC 9(18) COMP.

LINKAGE SECTION.
01 LNK-AVRO-SCHEMA.
   02 FILLER PIC X(1) OCCURS 0 TO 32767 TIMES DEPENDING ON LNK-AVRO-SCHEMA-LENGTH.
01 LNK-PROJECTION.
   02 FILLER PIC X(1) OCCURS 0 TO 32767 TIMES DEPENDING ON LNK-PROJECTION-LENGTH.
01 LNK-SPEC-ID PIC 9(9).
01 LNK-CONTENT PIC X(11).
01 LNK-FILE-PATH PIC X(256).
01 LNK-FILE-FORMAT PIC X(20).
01 LNK-PARTITION-DATA.
   02 FILLER PIC X(1) OCCURS 0 TO 32767 TIMES DEPENDING ON LNK-PARTITION-DATA-LENGTH.
01 LNK-FILE-SIZE PIC 9(18) COMP.
01 LNK-RECORD-COUNT PIC 9(18) COMP.
01 LNK-COLUMN-SIZES PIC X(32766).
01 LNK-VALUE-COUNTS PIC X(32766).
01 LNK-NULL-VALUE-COUNTS PIC X(32766).
01 LNK-NAN-VALUE-COUNTS PIC X(32766).
01 LNK-LOWER-BOUNDS PIC X(32766).
01 LNK-UPPER-BOUNDS PIC X(32766).
01 LNK-SPLIT-OFFSETS PIC X(32766).
01 LNK-EQUALITY-FIELD-IDS PIC X(32766).
01 LNK-SORT-ORDER-ID PIC 9(9).
01 LNK-KEY-METADATA PIC X(32766).
01 LNK-REFERENCED-DATA-FILE PIC X(256).
01 LNK-CONTENT-OFFSET PIC 9(18) COMP.
01 LNK-CONTENT-SIZE PIC 9(18) COMP.

PROCEDURE DIVISION USING LNK-AVRO-SCHEMA, LNK-PROJECTION, LNK-SPEC-ID, LNK-CONTENT, LNK-FILE-PATH, LNK-FILE-FORMAT, LNK-PARTITION-DATA, LNK-FILE-SIZE, LNK-RECORD-COUNT, LNK-COLUMN-SIZES, LNK-VALUE-COUNTS, LNK-NULL-VALUE-COUNTS, LNK-NAN-VALUE-COUNTS, LNK-LOWER-BOUNDS, LNK-UPPER-BOUNDS, LNK-SPLIT-OFFSETS, LNK-EQUALITY-FIELD-IDS, LNK-SORT-ORDER-ID, LNK-KEY-METADATA, LNK-REFERENCED-DATA-FILE, LNK-CONTENT-OFFSET, LNK-CONTENT-SIZE.
    PERFORM BASE-FILE-INIT.
    PERFORM BASE-FILE-COPY USING LNK-AVRO-SCHEMA, LNK-PROJECTION, LNK-SPEC-ID, LNK-CONTENT, LNK-FILE-PATH, LNK-FILE-FORMAT, LNK-PARTITION-DATA, LNK-FILE-SIZE, LNK-RECORD-COUNT, LNK-COLUMN-SIZES, LNK-VALUE-COUNTS, LNK-NULL-VALUE-COUNTS, LNK-NAN-VALUE-COUNTS, LNK-LOWER-BOUNDS, LNK-UPPER-BOUNDS, LNK-SPLIT-OFFSETS, LNK-EQUALITY-FIELD-IDS, LNK-SORT-ORDER-ID, LNK-KEY-METADATA, LNK-REFERENCED-DATA-FILE, LNK-CONTENT-OFFSET, LNK-CONTENT-SIZE.
    GOBACK.

BASE-FILE-INIT.
    MOVE FUNCTION FILE-FORMAT-FROM-STRING('data') TO CONTENT.
    MOVE SPACES TO FILE-PATH.
    MOVE SPACES TO FILE-FORMAT.
    MOVE -1 TO SPEC-ID.
    MOVE 'EMPTY-STRUCT-TYPE' TO PARTITION-TYPE OF PARTITION-DATA.
    MOVE 0 TO RECORD-COUNT.
    MOVE -1 TO FILE-SIZE.
    MOVE SPACES TO COLUMN-SIZES.
    MOVE SPACES TO VALUE-COUNTS.
    MOVE SPACES TO NULL-VALUE-COUNTS.
    MOVE SPACES TO NAN-VALUE-COUNTS.
    MOVE SPACES TO LOWER-BOUNDS.
    MOVE SPACES TO UPPER-BOUNDS.
    MOVE SPACES TO KEY-METADATA.
    MOVE SPACES TO SPLIT-OFFSETS.
    MOVE SPACES TO EQUALITY-IDS.
    MOVE 0 TO SORT-ORDER-ID.
    MOVE SPACES TO REFERENCED-DATA-FILE.
    MOVE 0 TO CONTENT-OFFSET.
    MOVE 0 TO CONTENT-SIZE.
    MOVE 0 TO ROW-POSITION.

BASE-FILE-COPY.
    MOVE LNK-SPEC-ID TO SPEC-ID.
    MOVE LNK-CONTENT TO CONTENT.
    MOVE LNK-FILE-PATH TO FILE-PATH.
    MOVE LNK-FILE-FORMAT TO FILE-FORMAT.
    MOVE LNK-PARTITION-DATA TO PARTITION-DATA.
    MOVE LNK-FILE-SIZE TO FILE-SIZE.
    MOVE LNK-RECORD-COUNT TO RECORD-COUNT.
    MOVE LNK-COLUMN-SIZES TO COLUMN-SIZES.
    MOVE LNK-VALUE-COUNTS TO VALUE-COUNTS.
    MOVE LNK-NULL-VALUE-COUNTS TO NULL-VALUE-COUNTS.
    MOVE LNK-NAN-VALUE-COUNTS TO NAN-VALUE-COUNTS.
    MOVE LNK-LOWER-BOUNDS TO LOWER-BOUNDS.
    MOVE LNK-UPPER-BOUNDS TO UPPER-BOUNDS.
    MOVE LNK-KEY-METADATA TO KEY-METADATA.
    MOVE LNK-SPLIT-OFFSETS TO SPLIT-OFFSETS.
    MOVE LNK-EQUALITY-FIELD-IDS TO EQUALITY-IDS.
    MOVE LNK-SORT-ORDER-ID TO SORT-ORDER-ID.
    MOVE LNK-REFERENCED-DATA-FILE TO REFERENCED-DATA-FILE.
    MOVE LNK-CONTENT-OFFSET TO CONTENT-OFFSET.
    MOVE LNK-CONTENT-SIZE TO CONTENT-SIZE.
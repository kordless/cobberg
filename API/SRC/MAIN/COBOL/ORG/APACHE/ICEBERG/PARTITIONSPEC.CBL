IDENTIFICATION DIVISION.
PROGRAM-ID. PARTITION-SPEC.

ENVIRONMENT DIVISION.

DATA DIVISION.
COPY "ICEBERG-TYPES.cpy".

WORKING-STORAGE SECTION.
01 PARTITION-DATA-ID-START PIC 9(4) VALUE 1000.
01 PARTITION-SPEC-INSTANCE.
   05 SCHEMA PIC X(32768).
   05 SPEC-ID PIC 9(9).
   05 FIELDS OCCURS 1 TO 32767 TIMES DEPENDING ON FIELD-COUNT PIC X(32768).
   05 LAST-ASSIGNED-FIELD-ID PIC 9(9).
   05 PARTITION-FIELD-LIST PIC X(32768).
   05 FIELD-SOURCES-MAP PIC X(32768).
   05 JAVA-CLASSES PIC X(32768).
   05 PARTITION-TYPE PIC X(32768).
   05 RAW-PARTITION-TYPE PIC X(32768).
   05 FIELD-COUNT PIC 9(5).

PROCEDURE DIVISION.

IDENTIFICATION-SECTION.
  PARTITION-SPEC-INIT.
    MOVE SCHEMA TO PARTITION-SPEC-INSTANCE.
    MOVE SPEC-ID TO PARTITION-SPEC-INSTANCE.
    MOVE FIELDS TO PARTITION-SPEC-INSTANCE.
    MOVE LAST-ASSIGNED-FIELD-ID TO PARTITION-SPEC-INSTANCE.
    MOVE PARTITION-FIELD-LIST TO PARTITION-SPEC-INSTANCE.
    MOVE FIELD-SOURCES-MAP TO PARTITION-SPEC-INSTANCE.
    MOVE JAVA-CLASSES TO PARTITION-SPEC-INSTANCE.
    MOVE PARTITION-TYPE TO PARTITION-SPEC-INSTANCE.
    MOVE RAW-PARTITION-TYPE TO PARTITION-SPEC-INSTANCE.
    MOVE FIELD-COUNT TO PARTITION-SPEC-INSTANCE.

  SCHEMA-SECTION.
    PROCEDURE-ID. SCHEMA.
    RETURN PARTITION-SPEC-INSTANCE.SCHEMA.

  SPEC-ID-SECTION.
    PROCEDURE-ID. SPEC-ID.
    RETURN PARTITION-SPEC-INSTANCE.SPEC-ID.

  FIELDS-SECTION.
    PROCEDURE-ID. FIELDS.
    RETURN PARTITION-SPEC-INSTANCE.PARTITION-FIELD-LIST.

  IS-PARTITIONED-SECTION.
    PROCEDURE-ID. IS-PARTITIONED.
    IF PARTITION-SPEC-INSTANCE.FIELD-COUNT > 0 AND PARTITION-SPEC-INSTANCE.PARTITION-FIELD-LIST NOT EQUAL SPACES
       RETURN TRUE
    ELSE
       RETURN FALSE.

  IS-UNPARTITIONED-SECTION.
    PROCEDURE-ID. IS-UNPARTITIONED.
    PERFORM IS-PARTITIONED-SECTION.
    IF RETURN-CODE = 0
       RETURN TRUE
    ELSE
       RETURN FALSE.

  LAST-ASSIGNED-FIELD-ID-SECTION.
    PROCEDURE-ID. LAST-ASSIGNED-FIELD-ID.
    RETURN PARTITION-SPEC-INSTANCE.LAST-ASSIGNED-FIELD-ID.

  TO-UNBOUND-SECTION.
    PROCEDURE-ID. TO-UNBOUND.
    PERFORM PARTITION-SPEC-INIT.
    RETURN PARTITION-SPEC-INSTANCE.

  GET-FIELDS-BY-SOURCE-ID-SECTION.
    PROCEDURE-ID. GET-FIELDS-BY-SOURCE-ID.
    RETURN PARTITION-SPEC-INSTANCE.FIELD-SOURCES-MAP.

  PARTITION-TYPE-SECTION.
    PROCEDURE-ID. PARTITION-TYPE.
    RETURN PARTITION-SPEC-INSTANCE.PARTITION-TYPE.

  RAW-PARTITION-TYPE-SECTION.
    PROCEDURE-ID. RAW-PARTITION-TYPE.
    RETURN PARTITION-SPEC-INSTANCE.RAW-PARTITION-TYPE.

  JAVA-CLASSES-SECTION.
    PROCEDURE-ID. JAVA-CLASSES.
    RETURN PARTITION-SPEC-INSTANCE.JAVA-CLASSES.

  PARTITION-TO-PATH-SECTION.
    PROCEDURE-ID. PARTITION-TO-PATH.
    PERFORM PARTITION-SPEC-INIT.
    RETURN PARTITION-SPEC-INSTANCE.

  COMPATIBLE-WITH-SECTION.
    PROCEDURE-ID. COMPATIBLE-WITH.
    PERFORM PARTITION-SPEC-INIT.
    RETURN PARTITION-SPEC-INSTANCE.

  UNPARTITIONED-SPEC-SECTION.
    PROCEDURE-ID. UNPARTITIONED.
    MOVE ZEROS TO PARTITION-SPEC-INSTANCE.
    MOVE PARTITION-DATA-ID-START - 1 TO PARTITION-SPEC-INSTANCE.LAST-ASSIGNED-FIELD-ID.
    RETURN PARTITION-SPEC-INSTANCE.

  BUILDER-FOR-SECTION.
    PROCEDURE-ID. BUILDER-FOR.
    PERFORM PARTITION-SPEC-INIT.
    RETURN PARTITION-SPEC-INSTANCE.

  CHECK-CONFLICTS-SECTION.
    PROCEDURE-ID. CHECK-CONFLICTS.
    PERFORM PARTITION-SPEC-INIT.
    RETURN PARTITION-SPEC-INSTANCE.

  CASE-SENSITIVE-SECTION.
    PROCEDURE-ID. CASE-SENSITIVE.
    PERFORM PARTITION-SPEC-INIT. 
    RETURN PARTITION-SPEC-INSTANCE.

  IDENTITY-SECTION.
    PROCEDURE-ID. IDENTITY.
    PERFORM PARTITION-SPEC-INIT.
    RETURN PARTITION-SPEC-INSTANCE.

  YEAR-SECTION.
    PROCEDURE-ID. YEAR.
    PERFORM PARTITION-SPEC-INIT.
    RETURN PARTITION-SPEC-INSTANCE.

  MONTH-SECTION.
    PROCEDURE-ID. MONTH.
    PERFORM PARTITION-SPEC-INIT.
    RETURN PARTITION-SPEC-INSTANCE.

  DAY-SECTION.
    PROCEDURE-ID. DAY.
    PERFORM PARTITION-SPEC-INIT.
    RETURN PARTITION-SPEC-INSTANCE.

  HOUR-SECTION.
    PROCEDURE-ID. HOUR.
    PERFORM PARTITION-SPEC-INIT.
    RETURN PARTITION-SPEC-INSTANCE.

  BUCKET-SECTION.
    PROCEDURE-ID. BUCKET.
    PERFORM PARTITION-SPEC-INIT.
    RETURN PARTITION-SPEC-INSTANCE.

  TRUNCATE-SECTION.
    PROCEDURE-ID. TRUNCATE.
    PERFORM PARTITION-SPEC-INIT.
    RETURN PARTITION-SPEC-INSTANCE.

  ALWAYS-NULL-SECTION.
    PROCEDURE-ID. ALWAYS-NULL.
    PERFORM PARTITION-SPEC-INIT.
    RETURN PARTITION-SPEC-INSTANCE.

  ADD-SECTION.
    PROCEDURE-ID. ADD.
    PERFORM PARTITION-SPEC-INIT.
    RETURN PARTITION-SPEC-INSTANCE.

  BUILD-SECTION.
    PROCEDURE-ID. BUILD.
    PERFORM PARTITION-SPEC-INIT.
    CALL "CHECK-COMPATIBILITY" USING PARTITION-SPEC-INSTANCE, SCHEMA.
    RETURN PARTITION-SPEC-INSTANCE.

  BUILD-UNCHECKED-SECTION.
    PROCEDURE-ID. BUILD-UNCHECKED.
    PERFORM PARTITION-SPEC-INIT.
    RETURN PARTITION-SPEC-INSTANCE.

  HAS-SEQUENTIAL-IDS-SECTION.
    PROCEDURE-ID. HAS-SEQUENTIAL-IDS.
    PERFORM PARTITION-SPEC-INIT.
    RETURN PARTITION-SPEC-INSTANCE.

STOP RUN.
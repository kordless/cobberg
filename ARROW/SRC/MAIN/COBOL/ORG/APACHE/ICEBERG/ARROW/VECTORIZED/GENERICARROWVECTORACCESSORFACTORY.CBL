IDENTIFICATION DIVISION.
PROGRAM-ID. GENERICARROWVECTORACCESSORFACTORY.

ENVIRONMENT DIVISION.
REPOSITORY.
    COPY COPYBOOK FOR DECIMAL-FACTORY-INTERFACE.
    COPY COPYBOOK FOR STRING-FACTORY-INTERFACE.
    COPY COPYBOOK FOR ARRAY-FACTORY-INTERFACE.
    COPY COPYBOOK FOR STRUCT-CHILD-FACTORY-INTERFACE.

DATA DIVISION.
WORKING-STORAGE SECTION.
    01 DECIMAL-FACTORY-SUPPLIER PIC X.
    01 STRING-FACTORY-SUPPLIER PIC X.
    01 STRUCT-CHILD-FACTORY-SUPPLIER PIC X.
    01 ARRAY-FACTORY-SUPPLIER PIC X.

PROCEDURE DIVISION.
    MAIN-LOGIC.
        PERFORM GET-VECTOR-ACCESSOR.
        STOP RUN.

    GET-VECTOR-ACCESSOR.
        MOVE DICTIONARY TO WS-DICTIONARY.
        MOVE IS-DICTIONARY-ENCODED TO WS-IS-DICTIONARY-ENCODED.
        MOVE VECTOR TO WS-VECTOR.
        MOVE DESCRIPTOR TO WS-DESCRIPTOR.
        IF WS-IS-DICTIONARY-ENCODED
            PERFORM GET-DICTIONARY-VECTOR-ACCESSOR
        ELSE
            PERFORM GET-PLAIN-VECTOR-ACCESSOR.

    GET-DICTIONARY-VECTOR-ACCESSOR.
        EVALUATE WS-DESCRIPTOR-ORIGINAL-TYPE
            WHEN 'ENUM' OR 'JSON' OR 'UTF8' OR 'BSON'
                PERFORM GET-DICTIONARY-STRING-ACCESSOR
            WHEN 'INT_64' OR 'TIME_MICROS' OR 'TIMESTAMP_MILLIS' OR 'TIMESTAMP_MICROS'
                PERFORM GET-DICTIONARY-LONG-ACCESSOR
            WHEN 'DECIMAL'
                EVALUATE WS-DESCRIPTOR-PRIMITIVE-TYPE
                    WHEN 'BINARY' OR 'FIXED_LEN_BYTE_ARRAY'
                        PERFORM GET-DICTIONARY-DECIMAL-BINARY-ACCESSOR
                    WHEN 'INT64'
                        PERFORM GET-DICTIONARY-DECIMAL-LONG-ACCESSOR
                    WHEN 'INT32'
                        PERFORM GET-DICTIONARY-DECIMAL-INT-ACCESSOR
                    WHEN OTHER
                        RAISE UNSUPPORTED-OPERATION-EXCEPTION
                END-EVALUATE
            WHEN OTHER
                RAISE UNSUPPORTED-OPERATION-EXCEPTION
        END-EVALUATE.

    GET-PLAIN-VECTOR-ACCESSOR.
        EVALUATE WS-VECTOR-TYPE
            WHEN 'BIT-VECTOR'
                PERFORM GET-BOOLEAN-ACCESSOR
            WHEN 'INT-VECTOR'
                IF IS-DECIMAL(WS-DESCRIPTOR-PRIMITIVE-TYPE)
                    PERFORM GET-INT-BACKED-DECIMAL-ACCESSOR
                ELSE
                    PERFORM GET-INT-ACCESSOR
            WHEN 'BIGINT-VECTOR'
                IF IS-DECIMAL(WS-DESCRIPTOR-PRIMITIVE-TYPE)
                    PERFORM GET-LONG-BACKED-DECIMAL-ACCESSOR
                ELSE
                    PERFORM GET-LONG-ACCESSOR
            WHEN 'FLOAT4-VECTOR'
                PERFORM GET-FLOAT-ACCESSOR
            WHEN 'FLOAT8-VECTOR'
                PERFORM GET-DOUBLE-ACCESSOR
            WHEN 'DECIMAL-VECTOR'
                PERFORM GET-DECIMAL-ACCESSOR
            WHEN 'VARCHAR-VECTOR'
                PERFORM GET-STRING-ACCESSOR
            WHEN 'VARBINARY-VECTOR'
                PERFORM GET-BINARY-ACCESSOR
            WHEN 'DATEDAY-VECTOR'
                PERFORM GET-DATE-ACCESSOR
            WHEN 'TIMESTAMPMICROTZ-VECTOR'
                PERFORM GET-TIMESTAMPMICRCOTZ-ACCESSOR
            WHEN 'TIMESTAMPMICRO-VECTOR'
                PERFORM GET-TIMESTAMPMICRO-ACCESSOR
            WHEN 'TIMEMICRO-VECTOR'
                PERFORM GET-TIMEMICRO-ACCESSOR
            WHEN 'LISTVECTOR'
                PERFORM GET-ARRAY-ACCESSOR
            WHEN 'STRUCTVECTOR'
                PERFORM GET-STRUCT-ACCESSOR
            WHEN 'FIXEDSIZEBINARY-VECTOR'
                IF IS-DECIMAL(WS-DESCRIPTOR-PRIMITIVE-TYPE)
                    PERFORM GET-FIXEDSIZEBINARYBACKEDDECIMAL-ACCESSOR
                ELSE
                    PERFORM GET-FIXEDSIZEBINARY-ACCESSOR
            WHEN OTHER
                RAISE UNSUPPORTED-OPERATION-EXCEPTION
        END-EVALUATE.

    GET-BOOLEAN-ACCESSOR.
        MOVE BIT-VECTOR TO WS-BIT-VECTOR.
        SET BOOLEAN-ACCESSOR TO TRUE.

    GET-INT-ACCESSOR.
        MOVE INT-VECTOR TO WS-INT-VECTOR.
        SET INT-ACCESSOR TO TRUE.

    GET-LONG-ACCESSOR.
        MOVE BIGINT-VECTOR TO WS-BIGINT-VECTOR.
        SET LONG-ACCESSOR TO TRUE.

    GET-FLOAT-ACCESSOR.
        MOVE FLOAT4-VECTOR TO WS-FLOAT4-VECTOR.
        SET FLOAT-ACCESSOR TO TRUE.

    GET-DOUBLE-ACCESSOR.
        MOVE FLOAT8-VECTOR TO WS-FLOAT8-VECTOR.
        SET DOUBLE-ACCESSOR TO TRUE.

    GET-DECIMAL-ACCESSOR.
        MOVE DECIMAL-VECTOR TO WS-DECIMAL-VECTOR.
        MOVE DECIMAL-FACTORY-SUPPLIER TO WS-DECIMAL-FACTORY.
        SET DECIMAL-ACCESSOR TO TRUE.

    GET-STRING-ACCESSOR.
        MOVE VARCHAR-VECTOR TO WS-VARCHAR-VECTOR.
        MOVE STRING-FACTORY-SUPPLIER TO WS-STRING-FACTORY.
        SET STRING-ACCESSOR TO TRUE.

    GET-BINARY-ACCESSOR.
        MOVE VARBINARY-VECTOR TO WS-VARBINARY-VECTOR.
        SET BINARY-ACCESSOR TO TRUE.

    GET-DATE-ACCESSOR.
        MOVE DATEDAY-VECTOR TO WS-DATEDAY-VECTOR.
        SET DATE-ACCESSOR TO TRUE.

    GET-TIMESTAMPMICRCOTZ-ACCESSOR.
        MOVE TIMESTAMPMICROTZ-VECTOR TO WS-TIMESTAMPMICROTZ-VECTOR.
        SET TIMESTAMPMICRCOTZ-ACCESSOR TO TRUE.

    GET-TIMESTAMPMICRO-ACCESSOR.
        MOVE TIMESTAMPMICRO-VECTOR TO WS-TIMESTAMPMICRO-VECTOR.
        SET TIMESTAMPMICRO-ACCESSOR TO TRUE.

    GET-TIMEMICRO-ACCESSOR.
        MOVE TIMEMICRO-VECTOR TO WS-TIMEMICRO-VECTOR.
        SET TIMEMICRO-ACCESSOR TO TRUE.

    GET-ARRAY-ACCESSOR.
        MOVE LISTVECTOR TO WS-LISTVECTOR.
        MOVE ARRAY-FACTORY-SUPPLIER TO WS-ARRAY-FACTORY.
        SET ARRAY-ACCESSOR TO TRUE.

    GET-STRUCT-ACCESSOR.
        MOVE STRUCTVECTOR TO WS-STRUCTVECTOR.
        MOVE STRUCT-CHILD-FACTORY-SUPPLIER TO WS-STRUCT-CHILD-FACTORY.
        SET STRUCT-ACCESSOR TO TRUE.

    GET-FIXEDSIZEBINARY-ACCESSOR.
        MOVE FIXEDSIZEBINARY-VECTOR TO WS-FIXEDSIZEBINARY-VECTOR.
        MOVE STRING-FACTORY-SUPPLIER TO WS-STRING-FACTORY.
        SET FIXEDSIZEBINARY-ACCESSOR TO TRUE.

    GET-FIXEDSIZEBINARYBACKEDDECIMAL-ACCESSOR.
        MOVE FIXEDSIZEBINARY-VECTOR TO WS-FIXEDSIZEBINARY-VECTOR.
        MOVE DECIMAL-FACTORY-SUPPLIER TO WS-DECIMAL-FACTORY.
        SET FIXEDSIZEBINARYBACKEDDECIMAL-ACCESSOR TO TRUE.

    GET-DICTIONARY-STRING-ACCESSOR.
        MOVE INT-VECTOR TO WS-INT-VECTOR.
        MOVE DICTIONARY TO WS-DICTIONARY.
        MOVE STRING-FACTORY-SUPPLIER TO WS-STRING-FACTORY.
        SET DICTIONARY-STRING-ACCESSOR TO TRUE.

    GET-DICTIONARY-LONG-ACCESSOR.
        MOVE INT-VECTOR TO WS-INT-VECTOR.
        MOVE DICTIONARY TO WS-DICTIONARY.
        SET DICTIONARY-LONG-ACCESSOR TO TRUE.

    GET-DICTIONARY-DECIMAL-BINARY-ACCESSOR.
        MOVE INT-VECTOR TO WS-INT-VECTOR.
        MOVE DICTIONARY TO WS-DICTIONARY.
        MOVE DECIMAL-FACTORY-SUPPLIER TO WS-DECIMAL-FACTORY.
        SET DICTIONARY-DECIMAL-BINARY-ACCESSOR TO TRUE.

    GET-DICTIONARY-DECIMAL-LONG-ACCESSOR.
        MOVE INT-VECTOR TO WS-INT-VECTOR.
        MOVE DICTIONARY TO WS-DICTIONARY.
        MOVE DECIMAL-FACTORY-SUPPLIER TO WS-DECIMAL-FACTORY.
        SET DICTIONARY-DECIMAL-LONG-ACCESSOR TO TRUE.

    GET-DICTIONARY-DECIMAL-INT-ACCESSOR.
        MOVE INT-VECTOR TO WS-INT-VECTOR.
        MOVE DICTIONARY TO WS-DICTIONARY.
        MOVE DECIMAL-FACTORY-SUPPLIER TO WS-DECIMAL-FACTORY.
        SET DICTIONARY-DECIMAL-INT-ACCESSOR TO TRUE.

    GET-INT-BACKED-DECIMAL-ACCESSOR.
        MOVE INT-VECTOR TO WS-INT-VECTOR.
        MOVE DECIMAL-FACTORY-SUPPLIER TO WS-DECIMAL-FACTORY.
        SET INT-BACKED-DECIMAL-ACCESSOR TO TRUE.

    GET-LONG-BACKED-DECIMAL-ACCESSOR.
        MOVE BIGINT-VECTOR TO WS-BIGINT-VECTOR.
        MOVE DECIMAL-FACTORY-SUPPLIER TO WS-DECIMAL-FACTORY.
        SET LONG-BACKED-DECIMAL-ACCESSOR TO TRUE.

    IS-DECIMAL.
        IF WS-DESCRIPTOR-PRIMITIVE-TYPE-ANNOTATION IS DECIMAL-LOGICAL-TYPE-ANNOTATION
            RETURN TRUE
        ELSE
            RETURN FALSE.

COPYBOOK FOR DECIMAL-FACTORY-INTERFACE.
    01 DECIMAL-FACTORY.
        05 GENERIC-CLASS PIC X.
        05 OF-LONG PIC X.
        05 OF-BIGDECIMAL PIC X.

COPYBOOK FOR STRING-FACTORY-INTERFACE.
    01 STRING-FACTORY.
        05 GENERIC-CLASS PIC X.
        05 OF-ROW-VARCHARVECTOR PIC X.
        05 OF-ROW-FIXEDSIZEBINARYVECTOR PIC X.
        05 OF-BYTES PIC X.
        05 OF-BYTEBUFFER PIC X.

COPYBOOK FOR ARRAY-FACTORY-INTERFACE.
    01 ARRAY-FACTORY.
        05 OF-CHILD PIC X.
        05 OF-ROW PIC X.

COPYBOOK FOR STRUCT-CHILD-FACTORY-INTERFACE.
    01 STRUCT-CHILD-FACTORY.
        05 GENERIC-CLASS PIC X.
        05 OF PIC X.

STOP RUN.